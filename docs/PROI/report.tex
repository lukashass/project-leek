\documentclass[10pt, a4paper, draft]{article}
 \usepackage[ngerman]{babel}
 \usepackage[utf8]{inputenc}
 \usepackage[T1]{fontenc}
 \usepackage{color}
 \usepackage{hyperref}

\title{Projektbreicht Smart Music Player}
\author{Anton Bracke\\Jan Eberlein\\Tom Calvin Haak\\Julian Hahn\\Nick Loewecke}

\begin{document}
\maketitle
\tableofcontents

\section{Einleitung}
\subsection{Unternehmen}
\colorbox{red}{was macht macio aus}
\subsection{Projekt}
Im Rahmen des Bachelor-Moduls Projekt Informatik möchte Macio deren Portfolio im IoT-Bereich erweitern sowie den Empfangsraum in Kiel verschönern.
Smarte Spielzeuge mit NFC-Funktion gibt es im Kommerzbereich viele, daher soll dieses Projekt eine Open-Source-Alternative dafür schaffen.
Genauer handelt es sich um einen Smarten Music Player, der NFC sowie Spotify Connect unterstützt.
Dieser Music Player hat einen Microcontroller mit NFC-Reader.
Auf die Box können durch kleine Figuren in Form von z.B. Figuren mit dem integrierten NFC-Tag Events getriggert werden.
Bei einem Event wird vom Microcontroller über jeweilige Musikdienst-API auf einem verbundenen Gerät Musik abgespielt.
Die NFC-Tags und zugehörigen Events sollen über ein Web-Frontend konfiguriert werden können.
Dieses Web-Frontend wird von der Box ausgeliefert und soll für primär eine Smartphone bedienung gestaltet werden.
Da es sich um ein Open Source Projekt handelt mit entsprechender Lizenz, muss auch eine aussagekräftige, öffentliche Dokumentation verfasst werden.
Macio stellt die benötigte Hardware und ist für Technische Fragen unterstützend verfügbar.

\subsubsection{Minimal Requirements}
\begin{enumerate}
  \item NFC-Tags lesen, schreiben und entschlüsseln
  \item Mit Spotify Connect verbinden und arbeiten
  \item Responsive UI konzeptionieren und umsetzen
  \item Aussagekräftige Dokumentation mit Benutzerhandbuch
\end{enumerate}
\subsubsection{Stretch Goals}
\begin{enumerate}
  \item Sound Wiedergabe auf der Box selbst
  \item Unterstützung anderer Musikdienste / Plugin-Subsystem
  \item 3D-Modellierung und Print einer passenden Box
  \item Cloud-Anbindung der Box, Auslieferung des UI aus der Cloud
\end{enumerate}

\section{Machbarkeitsstudie}

\subsection{NFC Tag}
\subsubsection{lesen}
Um mit NFC Tags arbeiten zu können, müssen diese auch auf entschlüsselt bzw. gelesen werden können.
Hierfür ist ein Hardware NFC-Reader notwendig. Dieser kann über USB mit dem Chip der Box verbunden werden, um von dieser ausgelesen zu werden.
\colorbox{yellow}{welche library wird genutzt?}

\subsubsection{schreiben}
Einen NFC-Tag zu beschreiben ist davon abhängig, ob der NFC-Tag über einen eigenen Speicher verfügt.
Ist dieser vorhanden, können dort z.b. Kontaktdaten hinterlegt werden. Werden diese dann von einem Smartphone gelesen, öffnet sich die Kontakte-App und der auf dem NFC-Tag gespeicherte Kontakt kann abgespeichert werden.
\colorbox{yellow}{Möglich, kann die gleiche library wie zum lesen genutzt werden?}

\subsection{Raspberri Pi}
\subsubsection{Docker Integration}
Docker auf einem Raspberri Pi laufen zu lassen ist möglich und in vielen Anleitungen online nachlesbar.\footnote{https://phoenixnap.com/kb/docker-on-raspberry-pi}

\subsubsection{Öffentlich zugängliches Web Interface}
Um den Web Server vom Pi von außerhalb des Netzwerkes erreichen zu können, muss innerhalb des Routers der Port 80 \colorbox{yellow}{port forwarded} werden.
Dann kann der Pi unter dessen IP xxx.xxx.xxx.xxx:80 erreicht werden.
Wenn die IP Adresse sich nicht ändern soll, kann auch eine statische IP festgelegt werden \footnote{https://howchoo.com/pi/configure-static-ip-address-raspberry-pi}. Dazu könnte dann eine Domain gekauft werden, die dann z.b. mit Cloudflare auf diese statische IP weiterleitet.
Alternativ ginge es auch ohne Port-Forwarding mit nginx und ngrok \footnote{https://vatsalyagoel.com/setting-up-a-public-web-server-using-a-raspberry-pi-3/}.

\subsubsection{URL für UI festlegen}
Über ein DNS Service, der auf dem Raspberri Pi läuft, wäre es möglich für die statische Public-IP eine eigene URL anzulegen.
Dafür sind verschiedene DNS Services möglich, potentiell ist auch eine Domain notwendig.

\subsection{User Interface}
\subsubsection{Zugriff auf NFC Reader im Cloud Szenario}
Tendenziell sollte es nicht notwendig sein, dass der Raspberri Pi, der das Web-UI hosted, auf den jeweiligen NFC-Reader der Box zugreifen muss.
Sollte das doch der Fall sein, könnte der Chip der Box ein API Call an den Raspberri Pi mit den NFC-Tag Daten machen, um das jeweilige hinterlegte Event zu triggern.

\subsubsection{Login via Spotify, Youtube, etc.}
\colorbox{red}{todo: ask julian}

\subsubsection{Gleichen Nutzer bei verschiedenen Loginvarianten wiedererkennen}
Um gleiche Nutzer zu erkennen, müssten Merkmale angelegt werden, über diese gleiche Nutzer wiedererkennbar wären.
Die E-Mail wäre hierbei das einzigartigste Merkmal. Über Scopes in der OAuth Anfrage kann diese auch mitgeliefert werden.
Das setzt aber voraus, dass Nutzer immer die gleiche E-Mail nutzen, was nicht immer der Fall ist.
Man könnte dem (bereits eingeloggten) User die Möglichkeit geben, weitere Accounts zu diesem hinzuzufügen, sodass diese Accounts den gleichen Nutzer einloggen.
Bei diesem Ansatz sollten dann die jeweiligen verbundenen Accounts zu einer unique User-ID verbunden werden.

\subsubsection{Musik Artwork laden}
Sollte kein Problem sein, da alle Anfragen ein Array von Bildern enthalten \footnote{https://stackoverflow.com/questions/10123804/retrieve-cover-artwork-using-spotify-api}

\subsubsection{Eigene Bilder hochladen}
Eigene Bilder hochzuladen sollte möglich sein. In unserem Kontext mit Vue.js und Node.js würde das Plugin "vue-picture-input" helfen.
Damit könnte mit einem Axios Post an das Backend das Bild gesendet werden. \footnote{https://www.digitalocean.com/community/tutorials/vuejs-uploading-vue-picture-input}#

\subsubsection{Spotify connect Lautsprecher auswählen}
Das auswählen von einem spezifischen Spotify connected Lautsprecher ist möglich.
Über einen API Call an die Spotify API mit dem Endpunkt "/v1/me/player/device" liefert eine Liste von allen verbundenen Geräten.
Es kann auch der letzte aktive Lautsprecher genutzt werden. Dieser hat bei "is_active" den Wert "true".\footnote{https://developer.spotify.com/documentation/web-api/guides/using-connect-web-api/}

\subsubsection{Spotify connect Lautsprecher speichern}
Die Liste von verbundenen Geräten, die über den API Call an die Spotify API erhalten wird, enthält auch einen unique Eintrag "id". Dieser kann gespeichert werden.

\subsubsection{In Cloud UI die jeweilige Box auswählen}
In dem Szenario, dass wir nur ein Cloud UI bieten für alle Boxen bieten, muss es auch eine Möglichkeit geben, die Boxen auszuwählen, die gerade konfiguriert werden soll.
Jede Box könnte ein QR-Code erhalten, der beim Einloggen gescannt werden muss. Je nachdem kann diese Box dann im Account hinterlegt werden oder muss bei jedem Login gescannt werden.

\subsubsection{Boxdaten über Cloud UI ändern}
Dafür müsste eine API gebaut werden, damit der jeweilige Microcontroller der Box mit dem Cloud UI kommunizieren kann.

\subsubsection{Unterstützung von Youtube Music}
\colorbox{red}{TODO: Sollte möglich sein, aber Youtube Music ist ein Premium Inhakt. Gibt es hier etwas ähnliches wie Spotify Connected Speaker?}
\subsubsection{Unterstützung von Apple Music}
\colorbox{red}{TODO: Sollte möglich sein, brauch man "Premium" für spezifische Lieder?. Gibt es hier etwas ähnliches wie Spotify Connected Speaker?}
\subsubsection{Unterstützung von Deezer}
\colorbox{red}{TODO: Sollte möglich sein, brauch man "Premium" für spezifische Lieder?. Gibt es hier etwas ähnliches wie Spotify Connected Speaker?}
\subsubsection{Unterstützung von Tidal}
\colorbox{red}{TODO: Sollte möglich sein, Tidal unterstützt aber kein Free Model (oder doch?). Gibt es hier etwas ähnliches wie Spotify Connected Speaker?}
\subsubsection{Unterstützung von eigener Musik (USB Stick, MicroSD Karte, Cloud)}
\colorbox{red}{TODO: Dateien von einer SD Karte oder etc auszulesen sollte genauso gut funktionieren wie ein NFC Chip auszulesen, wenn nicht sogar einfacher mit einer library. Wiedergabe ist da nur schwieriger. Wiedergabe über Spotify ginge nur, wenn man das Directory in Spotify angibt als Offline Quelle, gibt es dafür eine API oder so?}


\subsection{Sonstiges}
\subsubsection{3D Print version}
Da unsere Box nicht übermäßig groß sein wird, sollten die meisten 3D-Drucker ausreichend sein. Das Modellieren einer 3D-Print Version ist am Ende abhängig von der Expertise der Gruppe. Abgesehen davon sollte es kein Problem darstellen.

\subsubsection{Sound Wiedergabe auf der Box selbst}
\colorbox{red}{todo}

\subsubsection{Box unter 30€ Kosten}
Ausgehend davon, dass wir nur einen Microcontroller wie den ESP32 nutzen, ist dieses Ziel einfach zu erreichen. Dazu wird noch das Web-UI in der Cloud benötigt sowie Speicher benötigt. \colorbox{red}{wie viel?}

\section{Design Mockups}
\colorbox{red}{setze pdfs ein}

\section{Durchführung}
\subsubsection{Technologien und Hilfsmittel}
\colorbox{red}{Vue, vscode, devops krams, etc}
Entwickelt wird mit Visual Studio Code, da dort einfach ein Subsystem mit Linux genutzt werden kann \footnote{https://code.visualstudio.com/docs/remote/wsl}.

\subsubsection{Projekt Management}
\colorbox{red}{ticket pool in github, alles zentral}

\subsubsection{Deployment Cycle}
\colorbox{red}{ziehe ticket > assigne dir selbst > draft PR > wenn fertig, setzte "undraft" > assigne 2 reviewer > merge master}

\subsubsection{Probleme während der Durchführung}
\colorbox{red}{zb }
\section{Code Walkthrough}
\colorbox{red}{vielleicht interessante Code Snippets?}
\section{Testing}
\colorbox{red}{wie haben wir getestet, haben wir getestet?}
\section{Technische Diagramme}
\colorbox{red}{ER Diagramme, UML, solcher krams}
 \end{document}